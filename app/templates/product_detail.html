{% extends "base.html" %}
{% block title %}Product Details{% endblock %}

{% block content %}

<section class="detail-section">

    <div class="detail-container">

        <!-- LEFT : Images -->
        <div class="detail-images">

            {% if product.images %}
            <img id="mainImage"
                 src="{{ url_for('static', filename=product.images[0].image_path|replace('/static/', '')|replace('static/', '')) }}"
                 class="main-img"
                 alt="{{ product.title }}"
                 data-fallback="{{ url_for('static', filename='images/logo.png') }}"
                 onerror="this.src=this.dataset.fallback;">

            <div class="thumb-row">
                {% for img in product.images %}
                <img src="{{ url_for('static', filename=img.image_path|replace('/static/', '')|replace('static/', '')) }}"
                     onclick="changeImage(this)"
                     alt="{{ product.title }}"
                     data-fallback="{{ url_for('static', filename='images/logo.png') }}"
                     onerror="this.src=this.dataset.fallback;">
                {% endfor %}
            </div>
            {% else %}
            <img id="mainImage" src="{{ url_for('static', filename='images/logo.png') }}" class="main-img" alt="{{ product.title }}">
            {% endif %}

        </div>

        <!-- RIGHT : Info -->
        <div class="detail-info">
            <h2>{{ product.title }}</h2>
            <p class="detail-price">₹ {{ product.price }}</p>

            <p class="detail-desc">
                {{ product.description }}
            </p>

            <div class="qty-box">
                <button onclick="decQty()">−</button>
                <input type="text" id="qty" value="1" readonly>
                <button onclick="incQty()">+</button>
            </div>

            <div class="detail-btns">
                <form method="POST" action="{{ url_for('cart.add_cart', product_id=product.id) }}" class="inline-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="cart-btn">Add to Cart</button>
                </form>
                <form method="POST" action="{{ url_for('cart.buy_now', product_id=product.id) }}" class="inline-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="buy-btn">Buy Now</button>
                </form>
            </div>

        </div>

    </div>

</section>

<script>
function changeImage(el){
    document.getElementById("mainImage").src = el.src;
}

function incQty(){
    let q = document.getElementById("qty");
    q.value = parseInt(q.value) + 1;
}

function decQty(){
    let q = document.getElementById("qty");
    if(q.value > 1){
        q.value = parseInt(q.value) - 1;
    }
}
</script>

{% endblock %}
